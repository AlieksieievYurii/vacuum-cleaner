# Bluetooth communication
This document describes how the communication between Rasbperry Pi Zero W and Android App is implemented via BLuetooth.

The entire process of communication is done by sending a JSON texts between two devices(Raspberry Pi and Android App). Each message is called `Packet`. Once the connection is established between two devices(in this case they are Raspberry Pi and Android App), packages can be sent in both directions. Raspberry Pi can accept requests and than handle it, also can send requests to the Android App.
![image](https://user-images.githubusercontent.com/39415360/135327957-4e9222cf-fe4f-478e-a888-0e3d026f421e.png)

## Packet
Packet is a main part which is sent between client&server and vice versa.
``` 
{
  "type": ...,
  "content": ...
}
```
Fields:
* `type` [string] - points which type of a packet it is. The value can be `REQUEST` if the packet represents a request. If the value is "RESPONSE" then it represents a response for the request.
* `content` [json] - contains the content of request or response.

## Packet as Request
This packet is supposed to be send from Client-to-Server.
``` 
{
  "type": "REQUEST",
  "content": {
    "request_name": ...,
    "request_id": ...,
    "parameters": ...
  }
}
```
Fields:
* `request_name` [string] - an unique name of a request.
* `request_id` [string] - an unique id of a request. The id must be generated by a client side(who is making request). Later the same id will be used in the response.
* (optional) `parameters` [json] - json object containing required input parameters for given request.

## Packet as Response
This sort of packet is supposed to be reveived by a client as a response from a request.
``` 
{
  "type": "RESPONSE",
  "content": {
    "request_id": ...,
    "request_name": ...,
    "status": ...,
    "error_message": ...,
    "response": ...
  }
}
```
Fields:
* `request_id` [string] - an unique id that is taken from a correspondent request.
* `request_name` [string] - a request name that is take from a correspondent request.
* `status` [string] - contaning a response status. `OK` - when the request is done successfuly, `ERROR` - the request is failed due to unexpected failure, `BAD_REQUEST` - when request parameters are bad.
* (optional) `error_message` [string] - if the `status` is `BAD_REQUEST` or `ERROR` this field is supposed to be added to the response, containing error message.
* (optional) `response` [json] - json object containing output response from the request.

---

# Core endpoints
This section describes Bluetooth requests in the core

### Test Packet
This request is about just validation whether the Bluetooth Service in the core works

Request name: `send_test_packet`</br>
Parameters: 
* `id` [string] - random string which will be returned in the response

Response:
* `id` [string] - the same id which is given in the parameters

### Get current Wifi settings
This request returns current Wifi settings of the Raspberry Pi

Request name: `get_wifi_settings`</br>
Parameters: --
Response:
* `ssid` [string] - SSID of the wifi
* `password` [string] - the password of wifi

### Set Wifi
This request sets given Wifi settins such as ssid and password. 
Note: The request takes at least 10 seconds

Request name: `set_wifi_settings`</br>
Parameters:
* `ssid` [string] - SSID of the wifi
* `password` [string] - password of the wifi

Response:
* `is_connected` [boolean] - is True if succeded to connect
* `ip` [string] - the given IP by the network
* (optional) `error_message` [string] - if something went wrong

